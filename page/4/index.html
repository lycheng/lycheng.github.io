<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Shing&#39;s logs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Shing&#39;s logs">
<meta property="og:url" content="http://yoursite.com/page/4/index.html">
<meta property="og:site_name" content="Shing&#39;s logs">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Shing">
<meta property="article:tag" content="golang, python">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Shing&#39;s logs" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Shing&#39;s logs</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-docker-simple-note" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/07/16/docker-simple-note/" class="article-date">
  <time datetime="2016-07-15T16:00:00.000Z" itemprop="datePublished">2016-07-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/07/16/docker-simple-note/">Docker 简要记录</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>docker 目前在 ubuntu apt 上面的版本官方并不维护，需要手动添加它的源才比较好。详细的官方文档可见 <a target="_blank" rel="noopener" href="https://docs.docker.com/engine/installation/linux/ubuntulinux/">这里</a>。</p>
<p>因为国外的 docker registry 太慢，所以可以选择国内的服务 <a target="_blank" rel="noopener" href="https://get.daocloud.io/">daocloud</a> 来进行加速。常用的镜像都能很快的下载。当然有能力的可以选择自己搭建私有的 registry。</p>
<p>安装之后可以看 docker 是否已经启动</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl status docker</span><br></pre></td></tr></table></figure>

<h3 id="安装镜像"><a href="#安装镜像" class="headerlink" title="安装镜像"></a>安装镜像</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo docker pull hello-world</span><br><span class="line"># OR</span><br><span class="line">dao pull hello-world</span><br></pre></td></tr></table></figure>

<p>上面两者是等效的，默认的 tag 都是 latest。安装之后可以列出 images 来查看</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker images</span><br></pre></td></tr></table></figure>

<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><h3 id="镜像操作"><a href="#镜像操作" class="headerlink" title="镜像操作"></a>镜像操作</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 删除镜像</span><br><span class="line"># 前提是没有正在运行的相关容器</span><br><span class="line">sudo docker rmi &lt;image&gt;:&lt;tag&gt;</span><br></pre></td></tr></table></figure>

<p>在镜像安装的时候可以看到这样的东西</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Pulling repository library/redis:2.8</span><br><span class="line"></span><br><span class="line">128182e1e85d: Download complete</span><br><span class="line">7f1aa6a73799: Download complete</span><br><span class="line">1a9852d2edd3: Download complete</span><br><span class="line">a3ed95caeb02: Download complete</span><br><span class="line">fbe8a4f1aa87: Download complete</span><br><span class="line">b94de088b6d8: Download complete</span><br><span class="line">6c8ccd839b1d: Download complete</span><br><span class="line">0fded1c9651d: Download complete</span><br><span class="line">51f5c6a04d83: Download complete</span><br></pre></td></tr></table></figure>

<p>上面的的每一行代表镜像的每一层（layer），仅可读，表示镜像那时候的文件系统的不同。在创建新的容器的时候，则在最新的层上面创建一层可读可写的容器层。如果把做了的修改保存下来，则就是新的层，这个 image 就更新了。</p>
<h3 id="容器操作"><a href="#容器操作" class="headerlink" title="容器操作"></a>容器操作</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 加载镜像到容器中</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 每执行以此就有一个新的容器</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 有一大堆参数指定各种例如网络，存储的信息</span></span><br><span class="line">sudo docker run &lt;image&gt;:&lt;tag&gt;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> daemon 的形式来跑服务</span></span><br><span class="line">sudo docker run -d &lt;image&gt;:&lt;tag&gt;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 列出容器信息</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -a 表示所有的容器，如果去掉则仅仅是正在运行的容器</span></span><br><span class="line">sudo docker ps -a</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除容器</span></span><br><span class="line">sudo docker rm &lt;id&gt;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除已经退出的容器</span></span><br><span class="line">sudo docker rm `sudo docker ps -aq -f status=exited`</span><br></pre></td></tr></table></figure>

<h3 id="docker-compose"><a href="#docker-compose" class="headerlink" title="docker-compose"></a>docker-compose</h3><p>docker-compose 是 docker 用来管理多个容器的工具。通过配置文件定义容器的参数，相应容器的依赖，对外的端口等等。</p>
<p>它的配置文件大概会长这样</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">redash:</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">redash/redash:latest</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;5000:5000&quot;</span></span><br><span class="line">  <span class="attr">links:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">redis</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">postgres</span></span><br><span class="line">  <span class="attr">environment:</span></span><br><span class="line">    <span class="attr">REDASH_STATIC_ASSETS_PATH:</span> <span class="string">&quot;../rd_ui/dist/&quot;</span></span><br><span class="line">    <span class="attr">REDASH_LOG_LEVEL:</span> <span class="string">&quot;INFO&quot;</span></span><br><span class="line">    <span class="attr">REDASH_REDIS_URL:</span> <span class="string">&quot;redis://redis:6379/0&quot;</span></span><br><span class="line">    <span class="attr">REDASH_DATABASE_URL:</span> <span class="string">&quot;postgresql://postgres@postgres/postgres&quot;</span></span><br><span class="line">    <span class="attr">REDASH_COOKIE_SECRET:</span> <span class="string">veryverysecret</span></span><br><span class="line"><span class="attr">redis:</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">redis:2.8</span></span><br><span class="line"><span class="attr">postgres:</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">postgres:9.3</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/opt/postgres-data:/var/lib/postgresql/data</span></span><br><span class="line"><span class="attr">redash-nginx:</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">redash/nginx:latest</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;80:80&quot;</span></span><br><span class="line">  <span class="attr">links:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">redash</span></span><br></pre></td></tr></table></figure>

<p>之后保存配置文件 <code>docker-compose.yml</code> 然后在当前的目录</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo docker-compose up</span><br><span class="line"></span><br><span class="line"><span class="comment"># 单独启用其中某个服务</span></span><br><span class="line">sudo docker-compose up postgres</span><br></pre></td></tr></table></figure>

<h2 id="root"><a href="#root" class="headerlink" title="root"></a>root</h2><p>容器内部的用户是 root，跟宿主的 root 是不同的。默认的情况下，run 参数 <code>--privileged=false</code>，同是 root 用户，但却不是所有的权限。可以基本不用担心安全问题。</p>
<p>到如果设置为 true 的话，问题就大了</p>
<blockquote>
<p>由于 Docker 容器与宿主机处于共享同一个内核操作系统的状态，因此，Docker 容器将完全拥有内核的管理权限</p>
</blockquote>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ol>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/understanding-docker/">官方文档</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/userguide/storagedriver/imagesandcontainers/">docker 的存储的相关概念</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/compose/overview/">docker compose</a></li>
<li><a target="_blank" rel="noopener" href="http://docs.daocloud.io/allen-docker/docker-root">docker root 安全问题</a></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/07/16/docker-simple-note/" data-id="ckx7kmlc0000jrzc88xx65psr" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/docker/" rel="tag">docker</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-golang-learning-4" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/07/09/golang-learning-4/" class="article-date">
  <time datetime="2016-07-08T16:00:00.000Z" itemprop="datePublished">2016-07-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/07/09/golang-learning-4/">Golang 学习 4</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>前面 1 ~ 3 系列是看着书来写的，后面的是自己遇到的一些问题的总结。</p>
<h2 id="类型转换"><a href="#类型转换" class="headerlink" title="类型转换"></a>类型转换</h2><p>Golang 是强类型语言，类型的转换必须显式转换，interface 除外。</p>
<p>数值类型的转换，哪怕是底层类型相同的 <code>int</code> 和 <code>int32</code> 也不能直接赋值。同理，自定义的类型哪怕底层类型相同也不能直接赋值。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> MyInt <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> i <span class="keyword">int</span> = <span class="number">100</span></span><br><span class="line">    <span class="keyword">var</span> j <span class="keyword">int32</span> = <span class="keyword">int32</span>(i) <span class="comment">// 显式类型转换</span></span><br><span class="line">    <span class="keyword">var</span> k MyInt = MyInt(i) <span class="comment">// 显式类型转换</span></span><br><span class="line">    fmt.Println(i)</span><br><span class="line">    fmt.Println(j)</span><br><span class="line">    fmt.Println(k)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>string 类型的转化可以借助 package <code>fmt</code> 和 <code>strconv</code> 来进行。</p>
<p>interface 的类型转换没那么复杂，但两者必须是包含关系，例如 A interface 的方法包含 b 的方法，则可以 <code>a = A</code> 但不能 <code>A = a</code>，例如</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> w io.Writer</span><br><span class="line">w = os.Stdout           <span class="comment">// OK: *os.File has Write method</span></span><br><span class="line">w = <span class="built_in">new</span>(bytes.Buffer)   <span class="comment">// OK: *bytes.Buffer has Write method</span></span><br><span class="line">w = time.Second         <span class="comment">// compile error: time.Duration lacks Write method</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> rwc io.ReadWriteCloser</span><br><span class="line">rwc = os.Stdout         <span class="comment">// OK: *os.File has Read, Write, Close methods</span></span><br><span class="line">rwc = <span class="built_in">new</span>(bytes.Buffer) <span class="comment">// compile error: *bytes.Buffer lacks Close method</span></span><br><span class="line"></span><br><span class="line">w = rwc                 <span class="comment">// OK</span></span><br><span class="line">rwc = w                 <span class="comment">// compile error: io.Writer lacks Close method</span></span><br></pre></td></tr></table></figure>

<p>当一个变量赋值到一个 interface 变量时，再转换回来需要需要使用类型断言</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Stringer <span class="keyword">interface</span> &#123;</span><br><span class="line">    String() <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">str</span><span class="params">(val <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> s := val.(<span class="keyword">type</span>) &#123; <span class="comment">// 类型断言</span></span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">string</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;I&#x27;m String:&quot;</span> + s</span><br><span class="line">    <span class="keyword">case</span> Stringer:</span><br><span class="line">        <span class="keyword">return</span> s.String()</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;I don&#x27;t KNOW&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Human <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h Human)</span> <span class="title">String</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;WOW&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Animal <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(str(<span class="string">&quot;asdada&quot;</span>)) <span class="comment">// I&#x27;m String:asdada</span></span><br><span class="line"></span><br><span class="line">    h := Human&#123;&#125;</span><br><span class="line">    fmt.Println(str(h)) <span class="comment">// WOW</span></span><br><span class="line"></span><br><span class="line">    a := Animal&#123;&#125;</span><br><span class="line">    fmt.Println(str(a)) <span class="comment">// I don&#x27;t KNOW</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上述的函数 <code>str</code> 中，接收的参数是空的 interface，在函数调用的时候进行了隐式的类型转换，因为任何类型都包括空的 interface。</p>
<h3 id="interface-内存结构"><a href="#interface-内存结构" class="headerlink" title="interface 内存结构"></a>interface 内存结构</h3><p>Golang 中的 interface 包括两个部分</p>
<ol>
<li>底层的数据</li>
<li>描述符，即方法表</li>
</ol>
<p>方法表中，关联着相关类型和方法列表。这些都不是动态类型，所以可以用来进行类型检查。底层数据存放的是复制的一份新的原始数据。在调用的时候，将底层数据作为方法的第一个参数来进行调用。</p>
<p>空的 interface 就是方法表为空的变量。</p>
<h2 id="slice"><a href="#slice" class="headerlink" title="slice"></a>slice</h2><p>slice 是变长数组，在使用的时候有些需要注意的地方。</p>
<p>首先看下 slice 的结构</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Slice <span class="keyword">struct</span>&#123;</span><br><span class="line">    <span class="keyword">byte</span>*    array;        <span class="comment">// actual data</span></span><br><span class="line">    uintgo    <span class="built_in">len</span>;        <span class="comment">// number of elements</span></span><br><span class="line">    uintgo    <span class="built_in">cap</span>;        <span class="comment">// allocated number of elements</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">appendSlice</span><span class="params">(array []<span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    array[<span class="number">0</span>] = <span class="number">10000</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;%p\n&quot;</span>, array)</span><br><span class="line">    array = <span class="built_in">append</span>(array, <span class="number">5</span>)</span><br><span class="line">    fmt.Printf(<span class="string">&quot;%p\n&quot;</span>, array) <span class="comment">// 与上面的地址不同</span></span><br><span class="line">    array[<span class="number">0</span>] = <span class="number">10001</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    l := []<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;</span><br><span class="line">    fmt.Println(l) <span class="comment">// [1 2 3 4]</span></span><br><span class="line">    appendSlice(l)</span><br><span class="line">    fmt.Println(l) <span class="comment">// [10000 2 3 4]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上述代码中，修改 slice 里面元素的值成功了，但是 append 失败了。因为 Golang 中传参数是复制的，对 slice 内部的 array 复制进去了，所以修改是成功的。但是 append 之后其实是将旧的 slice 复制到了新的 slice，然后已经是一个新的值了，所以修改是不成功的。</p>
<h2 id="new-amp-make"><a href="#new-amp-make" class="headerlink" title="new &amp; make"></a>new &amp; make</h2><p><code>new</code> 方法返回空值的结构体的指针，类似于 <code>&amp;File&#123;fd, name, nil, 0&#125;</code> 这样的结构，不过其内部的成员都各自为其类型对应的空值。</p>
<p><code>make</code> 用于 slice, channel, map 类型的初始化。与 <code>new</code> 不同的是，<code>make</code> 分配对象相应的指定的存储空间，但不会置对应的空值，不返回指针。</p>
<h2 id="重复声明和重复赋值"><a href="#重复声明和重复赋值" class="headerlink" title="重复声明和重复赋值"></a>重复声明和重复赋值</h2><p>Golang 中的 <code>:=</code> 是赋值和声明的简写，该符号左边至少需要有一个新的变量，如果对以后的变量进行操作则会报错。</p>
<p>需要注意的是，如果在外层作用域定义的变量，再用 <code>:=</code> 进行赋值操作的话，则会屏蔽掉外层作用域的变量，特别是循环内部判断 <code>error</code> 的时候需要特别注意。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> err error</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++ &#123;</span><br><span class="line">    j, err := f()</span><br><span class="line"></span><br><span class="line">    fmt.Println(j)</span><br><span class="line">    fmt.Println(err) <span class="comment">// some error</span></span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(err) <span class="comment">// nil</span></span><br></pre></td></tr></table></figure>

<h2 id="一点总结"><a href="#一点总结" class="headerlink" title="一点总结"></a>一点总结</h2><p>用 Golang 大概一个多月，除了上手时候有点纠结外，感觉这门语言还是很舒服的。当然，标准库和第三方库还是不能和 Python 比，但编译检查静态错误的这个点开发起来很舒服，一些可能的问题能够尽早的发现。</p>
<p>interface 这点的引入能够减少不少的重复代码，变量默认零值也能让人逃开奇奇怪怪的构造函数的坑。</p>
<p>感觉在开发大型项目上，特别是系统级软件会比较适合。在使用过 Python 开发之后，越发觉得有必要加强开发工具对人的约束，代码风格的统一以及对无用 import 和无用变量的约束能够对共同开发起到良好的补充。</p>
<p>之后如果有耐心，希望可以把几个 Golang 常用的场景写下</p>
<ol>
<li>Golang 的反射，动态修改</li>
<li>Golang 的并发</li>
<li>…</li>
</ol>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ol>
<li><a target="_blank" rel="noopener" href="http://research.swtch.com/interfaces">interface 内存结构</a></li>
<li><a target="_blank" rel="noopener" href="https://golang.org/doc/effective_go.html">Effective Go</a></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/07/09/golang-learning-4/" data-id="ckx7kmlbz000grzc8dj069r2c" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/golang/" rel="tag">golang</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-golang-learning-3" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/07/04/golang-learning-3/" class="article-date">
  <time datetime="2016-07-03T16:00:00.000Z" itemprop="datePublished">2016-07-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/07/04/golang-learning-3/">Golang 学习 3</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="包管理"><a href="#包管理" class="headerlink" title="包管理"></a>包管理</h2><p>Golang 中的包 <code>package</code> 是代码组织的基本单位。与 <code>struct</code> 的方法相同，大写字母开头的就是该包对外可以访问的方法，变量。</p>
<p>每个文件开头的 <code>package</code> 关键字用来标识该文件所在的包名，通常就是包含该文件的文件目录名。</p>
<p>当导入包遇到重名的时候，可以像下面的代码一样</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;crypto/rand&quot;</span></span><br><span class="line">    mrand <span class="string">&quot;math/rand&quot;</span> <span class="comment">// alternative name mrand avoids conflict</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="匿名导入"><a href="#匿名导入" class="headerlink" title="匿名导入"></a>匿名导入</h3><p>因为在使用别的包的时候，如果仅仅是 import 但不使用的话是会报错的，但有种情况是仅仅希望执行某个包对应的 <code>init</code> 函数，因为在 import 的时候，会自动调用包里面各个文件的 <code>init</code> 函数。</p>
<p>像官网的例子，读取图片文件</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;image&quot;</span></span><br><span class="line">    <span class="string">&quot;image/jpeg&quot;</span></span><br><span class="line">    _ <span class="string">&quot;image/png&quot;</span> <span class="comment">// register PNG decoder</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>上述导入的 <code>image/png</code> 实际执行了以下的函数，详见 <a target="_blank" rel="noopener" href="https://golang.org/src/image/png/reader.go#L847">源文件</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">    image.RegisterFormat(<span class="string">&quot;png&quot;</span>, pngHeader, Decode, DecodeConfig)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行了 <a target="_blank" rel="noopener" href="https://golang.org/src/image/format.go#L24">image/format</a> 的 <code>RegisterFormat</code> 去注册解码器</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Formats is the list of registered formats.</span></span><br><span class="line"><span class="keyword">var</span> formats []format</span><br><span class="line"></span><br><span class="line"><span class="comment">// RegisterFormat registers an image format for use by Decode.</span></span><br><span class="line"><span class="comment">// Name is the name of the format, like &quot;jpeg&quot; or &quot;png&quot;.</span></span><br><span class="line"><span class="comment">// Magic is the magic prefix that identifies the format&#x27;s encoding. The magic</span></span><br><span class="line"><span class="comment">// string can contain &quot;?&quot; wildcards that each match any one byte.</span></span><br><span class="line"><span class="comment">// Decode is the function that decodes the encoded image.</span></span><br><span class="line"><span class="comment">// DecodeConfig is the function that decodes just its configuration.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">RegisterFormat</span><span class="params">(name, magic <span class="keyword">string</span>, decode <span class="keyword">func</span>(io.Reader)</span> <span class="params">(Image, error)</span>, <span class="title">decodeConfig</span> <span class="title">func</span><span class="params">(io.Reader)</span> <span class="params">(Config, error)</span>)</span> &#123;</span><br><span class="line">    formats = <span class="built_in">append</span>(formats, format&#123;name, magic, decode, decodeConfig&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当然，这里的仅仅是用来读文件，如果需要对 png 进行操作的话，还是需要导入 png 的 package。除了这里的图片操作以外，数据库操作也是类似的 <a target="_blank" rel="noopener" href="https://github.com/go-sql-driver/mysql#usage">代码</a>。</p>
<h3 id="工作区"><a href="#工作区" class="headerlink" title="工作区"></a>工作区</h3><p>Golang 中需要配置 <code>$GOPATH</code> 来指定工作区，换个角度来讲，只要控制 <code>$GOPATH</code> 就可以控制不同的工作区，防止不同的项目依赖互相污染。</p>
<h2 id="反射"><a href="#反射" class="headerlink" title="反射"></a>反射</h2><p>在编译的时候不知道变量的值，但是运行时可以进行检查判断，更新，这在 Golang 中就是反射。简单来说，反射是一种检验变量的类型和值的机制。这里面的操作对象是 interface。</p>
<h3 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x <span class="keyword">float64</span> = <span class="number">3.4</span></span><br><span class="line">v := reflect.ValueOf(x)</span><br><span class="line">fmt.Println(<span class="string">&quot;type:&quot;</span>, v.Type())</span><br><span class="line">fmt.Println(<span class="string">&quot;kind is float64:&quot;</span>, v.Kind() == reflect.Float64)</span><br><span class="line">fmt.Println(<span class="string">&quot;value:&quot;</span>, v.Float())</span><br><span class="line"></span><br><span class="line"><span class="comment">// type: float64</span></span><br><span class="line"><span class="comment">// kind is float64: true</span></span><br><span class="line"><span class="comment">// value: 3.4</span></span><br></pre></td></tr></table></figure>

<h3 id="从-interface-value-到-reflection-object-的"><a href="#从-interface-value-到-reflection-object-的" class="headerlink" title="从 interface value 到 reflection object 的"></a>从 interface value 到 reflection object 的</h3><p>reflect pacakge 的两个基本函数 <code>reflect.TypeOf</code> 和 <code>reflect.ValueOf</code>，都是接收 <code>interface&#123;&#125;</code> 的参数。任何类型都包含 empty interface，所以任何 interface 都能转成 <code>interface&#123;&#125;</code>。</p>
<p>如上述的代码一样，可以通过判断 reflect object 的类型来进行相应的输出</p>
<h3 id="从-reflection-object-到-interface-object"><a href="#从-reflection-object-到-interface-object" class="headerlink" title="从 reflection object 到 interface object"></a>从 reflection object 到 interface object</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> MyInt <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> x MyInt = <span class="number">7</span></span><br><span class="line"></span><br><span class="line">    v := reflect.ValueOf(x)</span><br><span class="line">    y := v.Interface().(MyInt) <span class="comment">// 这里如果用 int 会 panic</span></span><br><span class="line"></span><br><span class="line">    fmt.Println(v)</span><br><span class="line">    fmt.Println(v.Kind()) <span class="comment">// int</span></span><br><span class="line">    fmt.Println(v.Type()) <span class="comment">// main.MyInt</span></span><br><span class="line">    fmt.Println(y)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面的代码可以看到，<code>Kind</code> 方法不能正确辨识变量的类型，但 <code>Type</code> 可以，虽然底层类型都是一样的。</p>
<p>v 调用 <code>Interface</code> 之后返回的是 empty interface，可以用 <code>fmt.Println</code> 等方法能正确识别为 int 类型。</p>
<h3 id="想要修改-reflection-object，那该变量必须是-settable"><a href="#想要修改-reflection-object，那该变量必须是-settable" class="headerlink" title="想要修改 reflection object，那该变量必须是 settable"></a>想要修改 reflection object，那该变量必须是 settable</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x <span class="keyword">float64</span> = <span class="number">3.4</span></span><br><span class="line">v := reflect.ValueOf(x)</span><br><span class="line">v.SetFloat(<span class="number">7.1</span>) <span class="comment">// panic</span></span><br><span class="line"></span><br><span class="line">fmt.Println(<span class="string">&quot;settability of v:&quot;</span>, v.CanSet()) <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<p>错误的原因是 <code>reflect.Value.SetFloat using unaddressable value</code>，该变量是无法寻址的。reflect 中，可寻址标识可以修改变量实际存储的东西。在上面的函数调用中，复制了 <code>x</code>，即使修改也只是对函数内部的临时变量进行修改。</p>
<p>改成指针</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">p := reflect.ValueOf(&amp;x) <span class="comment">// Note: take the address of x.</span></span><br><span class="line">fmt.Println(<span class="string">&quot;type of p:&quot;</span>, p.Type())</span><br><span class="line">fmt.Println(<span class="string">&quot;settability of p:&quot;</span>, p.CanSet()) <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<p>指针也不行，我们实际需要修改的东西是 <code>p</code> 指向的内存，而不是 <code>p</code> 本身。正确的用法如下</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x <span class="keyword">float64</span> = <span class="number">3.4</span></span><br><span class="line">p := reflect.ValueOf(&amp;x)</span><br><span class="line">v := p.Elem()</span><br><span class="line"></span><br><span class="line">v.SetFloat(<span class="number">7.1</span>)</span><br><span class="line">fmt.Println(v.Interface())</span><br><span class="line">fmt.Println(x)</span><br><span class="line">fmt.Println(v)</span><br></pre></td></tr></table></figure>

<p>这里有点绕，需要仔细理解下才行。</p>
<p>三个用法看下来发现其实反射用起来是比较危险的，因为无法进行静态分析，程序可能在某个地方就 panic 了，在实际场景中因该尽量避免使用反射。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol>
<li><a target="_blank" rel="noopener" href="https://wizardforcel.gitbooks.io/gopl-zh/content/">Go 语言圣经</a></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/07/04/golang-learning-3/" data-id="ckx7kmlc4000qrzc8a6ifel23" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/golang/" rel="tag">golang</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-golang-learning-2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/06/25/golang-learning-2/" class="article-date">
  <time datetime="2016-06-24T16:00:00.000Z" itemprop="datePublished">2016-06-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/25/golang-learning-2/">Golang 学习 2</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="struct"><a href="#struct" class="headerlink" title="struct"></a>struct</h2><p>用于聚合数据的结构体，简单用法如下</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Employee <span class="keyword">struct</span> &#123;</span><br><span class="line">    ID        <span class="keyword">int</span></span><br><span class="line">    Name      <span class="keyword">string</span></span><br><span class="line">    Address   <span class="keyword">string</span></span><br><span class="line">    DoB       time.Time</span><br><span class="line">    Position  <span class="keyword">string</span></span><br><span class="line">    Salary    <span class="keyword">int</span></span><br><span class="line">    ManagerID <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> dilbert Employee</span><br><span class="line"></span><br><span class="line"><span class="comment">// . 操作</span></span><br><span class="line">dilbert.Salary = <span class="number">4000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 指针也是同样</span></span><br><span class="line">ptr := &amp;Employee&#123;&#125;</span><br><span class="line">ptr.ID = <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>结构体还是该结构体的指针，都支持 . 操作，两者是等效的。在需要传结构体当作参数的时候，最好是使用指针的方式，这就减少了复制结构体的成本。</p>
<p>结构体的成员大小写也跟 Go 本身的包导出规则类似，小写开头的参数如果使用在包外使用会报错。</p>
<h3 id="匿名嵌入"><a href="#匿名嵌入" class="headerlink" title="匿名嵌入"></a>匿名嵌入</h3><p>当需要一个结构体内加入另一个结构体的时候，可以用匿名成员，只在结构体内写类型或类型指针而不是成员变量。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> AA <span class="keyword">struct</span> &#123;</span><br><span class="line">    A <span class="keyword">int</span></span><br><span class="line">    C <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> BB <span class="keyword">struct</span> &#123;</span><br><span class="line">    AA</span><br><span class="line">    B <span class="keyword">int</span></span><br><span class="line">    C <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 直接访问而不是指定 b.AA.A</span></span><br><span class="line"></span><br><span class="line">b := BB&#123;&#125;</span><br><span class="line">b.A = <span class="number">1</span></span><br><span class="line">b.B = <span class="number">2</span></span><br><span class="line">b.C = <span class="number">3</span></span><br><span class="line">b.AA.C = <span class="number">1111</span></span><br><span class="line">fmt.Println(b) <span class="comment">// 结果 &#123;1 1111&#125; 2 3</span></span><br></pre></td></tr></table></figure>

<p>上面最后可以看到，如果是同名成员的话，会优先访问本类型的成员，忽略匿名成员，这点和其它语言类似。</p>
<p>但是初始化的时候还是得按照类型来。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">bb := BB&#123;</span><br><span class="line">    AA: AA&#123;A: <span class="number">1</span>&#125;,</span><br><span class="line">    B:  <span class="number">2</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h3><p>函数声明时，在函数前面加类型，则为该类型添加了一个方法。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Point <span class="keyword">struct</span> &#123;</span><br><span class="line">    X <span class="keyword">float64</span></span><br><span class="line">    Y <span class="keyword">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这里如果使用 p Point 来声明，在使用的时候也是一样的</span></span><br><span class="line"><span class="comment">// 但是调用的时候会发生以此 Point 的复制，所以尽量使用指针</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *Point)</span> <span class="title">ScaleBy</span><span class="params">(factor <span class="keyword">float64</span>)</span></span> &#123;</span><br><span class="line">    p.X *= factor</span><br><span class="line">    p.Y *= factor</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Point&#123;<span class="number">1</span>, <span class="number">2</span>&#125;.ScaleBy(<span class="number">2</span>) <span class="comment">// 临时变量则无法获取其地址，不能这样用</span></span><br></pre></td></tr></table></figure>

<p>须明确一点，<strong>所有的函数调用都是传值的，哪怕是 receiver</strong>。所以对于数据量大的方法更多应该考虑指针的 receiver。</p>
<h2 id="interface"><a href="#interface" class="headerlink" title="interface"></a>interface</h2><h3 id="方法集合"><a href="#方法集合" class="headerlink" title="方法集合"></a>方法集合</h3><p>类似于 <code>duck typing</code> 的意思，<code>interface</code>是一种类型，它定义一组方法，任何有实现这些方法的类型都能使用。常用于函数的参数定义中，我们不去关心这个类型具体做什么，而是关心这个类型能不能做我们想要的某些东西。如下面的 <code>fmt.Stringer</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> fmt</span><br><span class="line"><span class="comment">// The String method is used to print values passed</span></span><br><span class="line"><span class="comment">// as an operand to any format that accepts a string</span></span><br><span class="line"><span class="comment">// or to an unformatted printer such as Print.</span></span><br><span class="line"><span class="keyword">type</span> Stringer <span class="keyword">interface</span> &#123;</span><br><span class="line">    String() <span class="keyword">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>假如有一个函数，需要使用上述的 <code>String()</code>，则你在函数声明的时候可以传入一个 <code>fmt.Stringer</code>，任何实现了 <code>String()</code> 方法的类型都可以使用。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">testString</span><span class="params">(i fmt.Stringer)</span></span> &#123;</span><br><span class="line">    fmt.Println(i.String())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Human <span class="keyword">struct</span> &#123;</span><br><span class="line">    Name <span class="keyword">string</span></span><br><span class="line">    Age  <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h Human)</span> <span class="title">String</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> fmt.Sprintf(<span class="string">&quot;Name %s, Age %d&quot;</span>, h.Name, h.Age)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>值得注意的是，这里 <code>Human</code> 的 <code>String</code> 方法使用变量而不是指针作为 recevier。因为值类型的方法可以使用指针去访问，但是反过来不行。使用值类型的方法相对更通用一些。</p>
<h3 id="通用类型"><a href="#通用类型" class="headerlink" title="通用类型"></a>通用类型</h3><p>interface 无关是指针还是值，它是什么取决于你怎么去处理。</p>
<p>在很多标准库的定义中，很多函数接收 <code>v inteface&#123;&#125;</code> 的参数，意味着可以传入任何类型的变量。</p>
<p>使用原则简单来说就是 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Robustness_principle">宽以待人，严于律己</a>，如果返回 interface 类型的话则会需要后人去猜测变量的类型。你会看到在许多的函数参数中都会有 interface 类型，使用上更多是传入一个指针，这样就可以确认函数修改 / 更新的值是确定的。</p>
<h2 id="Goroutines-amp-amp-Channels"><a href="#Goroutines-amp-amp-Channels" class="headerlink" title="Goroutines &amp;&amp; Channels"></a>Goroutines &amp;&amp; Channels</h2><p>使用简单的语法就可以开启一个新的线程去执行函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go f()</span><br></pre></td></tr></table></figure>

<p>主函数也是一个 <code>goroutine</code>，当主函数退出，所有的 <code>goroutine</code> 都会退出。</p>
<p>不同的 <code>goroutine</code> 之间使用 <code>channel</code> 进行通信，<code>channel</code> 是指定类型的。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>) <span class="comment">// 无缓冲</span></span><br><span class="line">ch1 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">1</span>) <span class="comment">// 有缓冲</span></span><br><span class="line"></span><br><span class="line">ch &lt;- x  <span class="comment">// 发送</span></span><br><span class="line">x = &lt;-ch <span class="comment">// 接收</span></span><br><span class="line">&lt;-ch     <span class="comment">// 接收并抛弃</span></span><br></pre></td></tr></table></figure>

<p>上方代码中创建的无缓冲的 <code>channel</code>，这样子接受者和发送者都会同时阻塞，相当于两者做一次同步，当通过无缓冲的 <code>channel</code> 进行发送时，接受者收到数据发生在发送者唤醒之前。</p>
<p>需要注意的是，哪怕是有缓冲的 <code>channel</code> 在其没有元素的时候，接收动作 <code>&lt;-ch</code> 是阻塞的，直到有数据过来。</p>
<h3 id="select-的多路复用"><a href="#select-的多路复用" class="headerlink" title="select 的多路复用"></a>select 的多路复用</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line"><span class="keyword">case</span> &lt;-ch1:</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"><span class="keyword">case</span> x := &lt;-ch2:</span><br><span class="line">    <span class="comment">// ...use x...</span></span><br><span class="line"><span class="keyword">case</span> ch3 &lt;- y:</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当有多个 <code>channel</code> 需要进行监控的时候，可以用 <code>select</code> 的语法进行操作，只有在某个 <code>channel</code> 有数据时才会执行相应的 <code>case</code>，否则执行 <code>default</code> 块。</p>
<p><code>time</code> 包中有一个 Tick 函数能很方便地执行定时任务</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    tick := time.Tick(<span class="number">3</span> * time.Second)</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">100</span>; i++ &#123;</span><br><span class="line">        <span class="keyword">select</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> &lt;-tick:</span><br><span class="line">            fmt.Println(<span class="string">&quot;Do Some Thing&quot;</span>)</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            fmt.Println(<span class="string">&quot;Sleep 1s&quot;</span>)</span><br><span class="line">            time.Sleep(time.Duration(<span class="number">1</span>) * time.Second)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出如下</span></span><br><span class="line">Sleep <span class="number">1</span>s</span><br><span class="line">Sleep <span class="number">1</span>s</span><br><span class="line">Sleep <span class="number">1</span>s</span><br><span class="line">Do Some Thing</span><br><span class="line">Sleep <span class="number">1</span>s</span><br><span class="line">Sleep <span class="number">1</span>s</span><br><span class="line">Sleep <span class="number">1</span>s</span><br><span class="line">Do Some Thing</span><br><span class="line">Sleep <span class="number">1</span>s</span><br><span class="line">Sleep <span class="number">1</span>s</span><br><span class="line">Sleep <span class="number">1</span>s</span><br><span class="line">Do Some Thing</span><br><span class="line">Sleep <span class="number">1</span>s</span><br><span class="line">Sleep <span class="number">1</span>s</span><br><span class="line">Sleep <span class="number">1</span>s</span><br><span class="line">Do Some Thing</span><br><span class="line">Sleep <span class="number">1</span>s</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h3 id="channel-泄漏"><a href="#channel-泄漏" class="headerlink" title="channel 泄漏"></a>channel 泄漏</h3><p>上述代码中，<code>tick</code> 在循环之外还会继续作用，这种情况叫做 <code>channel</code> 的泄漏，它只适合用在整个程序生命周期都存在的情况。</p>
<p>当你试图去 <code>close</code> 的时候，则会报错</p>
<blockquote>
<p>invalid operation: close(tick) (cannot close receive-only channel)</p>
</blockquote>
<p>还有另一种 tick 能使用</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ticker := time.NewTicker(<span class="number">1</span> * time.Second)</span><br><span class="line">&lt;-ticker.C    <span class="comment">// receive from the ticker&#x27;s channel</span></span><br><span class="line">ticker.Stop() <span class="comment">// cause the ticker&#x27;s goroutine to terminate</span></span><br></pre></td></tr></table></figure>

<h3 id="退出多个-goroutine"><a href="#退出多个-goroutine" class="headerlink" title="退出多个 goroutine"></a>退出多个 goroutine</h3><p>如果维护了多个 goroutine 的话，需要类似于广播的一类事件，可以通过关闭一个 channel 来进行类似的操作。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> done = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;) <span class="comment">// 注意是无缓冲的</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">cancelled</span><span class="params">()</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">	<span class="keyword">select</span> &#123;</span><br><span class="line">	<span class="keyword">case</span> &lt;-done:</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">worker</span><span class="params">(i <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> cancelled() &#123;</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">        fmt.Printf(<span class="string">&quot;worker %d work\n&quot;</span>, i)</span><br><span class="line">        time.Sleep(time.Duration(<span class="number">1</span>) * time.Second)</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;worker %d cancelled\n&quot;</span>, i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">manager</span><span class="params">()</span></span> &#123;</span><br><span class="line">    time.Sleep(time.Duration(<span class="number">2</span>) * time.Second)</span><br><span class="line">    fmt.Println(<span class="string">&quot;close workers&quot;</span>)</span><br><span class="line">    <span class="built_in">close</span>(done)</span><br><span class="line">    time.Sleep(time.Duration(<span class="number">5</span>) * time.Second)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">1</span>; i &lt; <span class="number">5</span>; i++ &#123;</span><br><span class="line">        j := i</span><br><span class="line">        <span class="keyword">go</span> worker(j)</span><br><span class="line">    &#125;</span><br><span class="line">    manager()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="一些有趣的文章"><a href="#一些有趣的文章" class="headerlink" title="一些有趣的文章"></a>一些有趣的文章</h2><ol>
<li><a target="_blank" rel="noopener" href="http://marcio.io/2015/07/handling-1-million-requests-per-minute-with-golang/">Handling 1 Million Requests per Minute with Go</a></li>
<li><a target="_blank" rel="noopener" href="http://jordanorelli.com/post/32665860244/how-to-use-interfaces-in-go">Golang 的 interface</a></li>
<li><a target="_blank" rel="noopener" href="http://research.swtch.com/interfaces">Golang interface 的内存实现</a></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/06/25/golang-learning-2/" data-id="ckx7kmlby000erzc85nopbrqo" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/golang/" rel="tag">golang</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-golang-learning-1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/06/07/golang-learning-1/" class="article-date">
  <time datetime="2016-06-06T16:00:00.000Z" itemprop="datePublished">2016-06-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/07/golang-learning-1/">Golang 学习 1</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h2><p>不可变的字节序列。对于不同编码的字符串所有都是同样的操作，字符串的每一位都是一个 ASCII 值，需要额外进处理去解析 unicode 字符串。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;unicode/utf8&quot;</span></span><br><span class="line"></span><br><span class="line">s := <span class="string">&quot;Hello, 世界&quot;</span></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(s); &#123;</span><br><span class="line">    r, size := utf8.DecodeRuneInString(s[i:])</span><br><span class="line">    fmt.Printf(<span class="string">&quot;%d\t%c\n&quot;</span>, i, r)</span><br><span class="line">    i += size</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 也可以使用 range，Go 本身会自动处理 unicode</span></span><br><span class="line"><span class="comment">// 步长的递进可以看到也不是 1</span></span><br><span class="line"><span class="keyword">for</span> i, r := <span class="keyword">range</span> <span class="string">&quot;Hello, 世界&quot;</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;%d\t%q\t%d\n&quot;</span>, i, r, r)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="常量"><a href="#常量" class="headerlink" title="常量"></a>常量</h2><p>常量的值在编译期间就确定了。常量定义可用一个 <code>iota</code> 去生成，类似于枚举类型。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Weekday <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">    Sunday Weekday = <span class="literal">iota</span> <span class="comment">// 0</span></span><br><span class="line">    Monday                <span class="comment">// 1 以下以此类推</span></span><br><span class="line">    Tuesday</span><br><span class="line">    Wednesday</span><br><span class="line">    Thursday</span><br><span class="line">    Friday</span><br><span class="line">    Saturday</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="无类型常量"><a href="#无类型常量" class="headerlink" title="无类型常量"></a>无类型常量</h3><p>如果常量的定义的时候不指定类型，如</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> (</span><br><span class="line">    E = <span class="number">2.71828182845904523536028747135266249775724709369995957496696763</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>编译器会提供一个比基础类型更高的运算精度，并且可以无需显式的类型转换就能直接赋值给基础类型。 </p>
<h2 id="复合类型"><a href="#复合类型" class="headerlink" title="复合类型"></a>复合类型</h2><h3 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h3><p>固定长度的特定元素的序列，因为不可扩展，一般直接用 <code>slice</code>。</p>
<h3 id="slice"><a href="#slice" class="headerlink" title="slice"></a>slice</h3><p>与数组不同的是，在初始化的时候无需指定长度。而且对 slice 的比较操作也是非法的。</p>
<p>需要注意的是，slice 的切片操作不是复制，而是引用，意味着修改会改变原始数据。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a := []<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;</span><br><span class="line">b := a[:<span class="number">3</span>]</span><br><span class="line">b[<span class="number">0</span>] = <span class="number">12313</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// a = [12313 2 3 4 5]</span></span><br><span class="line"><span class="comment">// b = [12313 2 3]</span></span><br></pre></td></tr></table></figure>

<h3 id="map"><a href="#map" class="headerlink" title="map"></a>map</h3><p>map 可以用于和 <code>nil</code> 进行比较，但赋值操作必须先进行 <code>make</code> 来创建 map。</p>
<p>可以用 <code>map[string]bool</code> 来实现简单的 set 操纵</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">set := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">bool</span>)</span><br><span class="line">set[<span class="string">&quot;a&quot;</span>] = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">fmt.Println(set[<span class="string">&quot;a&quot;</span>]) <span class="comment">// true</span></span><br><span class="line">fmt.Println(set[<span class="string">&quot;b&quot;</span>]) <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<p>因为类型是确定的，所以在使用的时候可以放心使用，在不存在 key 的情况下返回的都是该类型的空值。</p>
<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><p>Go 中函数是 first-class function，函数的参数传递是值传递，因此引用类型的传递会对函数体外的变量进行修改。</p>
<p>函数声明时，可提供返回值的参数变量名，之后该变量就会被声明成该函数内部的一个局部变量，按照该类型来进行初始化，返回时也不需要明确返回。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sum</span><span class="params">(x, y <span class="keyword">float64</span>)</span> <span class="params">(z <span class="keyword">float64</span>)</span></span> &#123;</span><br><span class="line">    z = x + y</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="可变参数"><a href="#可变参数" class="headerlink" title="可变参数"></a>可变参数</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sum</span><span class="params">(vals...<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    total := <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> _, val := <span class="keyword">range</span> vals &#123;</span><br><span class="line">        total += val</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> total</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对于一个 slice 可以用下面的方法求和</span></span><br><span class="line">values := []<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;</span><br><span class="line">fmt.Println(sum(values...)) <span class="comment">// &quot;10&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h3><h4 id="defer"><a href="#defer" class="headerlink" title="defer"></a>defer</h4><p>Go 中使用 <code>defer</code> 关键字来指定在函数 return 之后的操作，如常见的打开文件，关闭文件。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src.Close() 在 return 之后执行</span></span><br><span class="line">src, err := os.Open(srcName)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">defer</span> src.Close()</span><br></pre></td></tr></table></figure>

<p>这里有几个点需要注意的</p>
<p>1 <code>defer</code>中的函数参数是声明的时候确定的，与 <code>return</code> 的位置无关</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">a</span><span class="params">()</span></span> &#123;</span><br><span class="line">    i := <span class="number">0</span></span><br><span class="line">    <span class="keyword">defer</span> fmt.Println(i) <span class="comment">// print 0</span></span><br><span class="line">    i++</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2 <code>defer</code> 的执行顺序为 FILO，后声明的 <code>defer</code> 先执行</p>
<p>3 <code>defer</code> 可以更新命名的返回值（named return variables）</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">c</span><span class="params">()</span> <span class="params">(i <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; i++ &#125;() <span class="comment">// return 2</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="panic-amp-recover"><a href="#panic-amp-recover" class="headerlink" title="panic &amp; recover"></a>panic &amp; recover</h4><p><code>panic</code> 函数执行之后，正常的函数流程就会停止，转去执行 <code>defer</code> 定义的行为。</p>
<p><code>recover</code> 只能在 <code>defer</code> 内的函数使用。三者加起来的用法大概如下</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    f()</span><br><span class="line">    fmt.Println(<span class="string">&quot;Returned normally from f.&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> r := <span class="built_in">recover</span>(); r != <span class="literal">nil</span> &#123;</span><br><span class="line">            fmt.Println(<span class="string">&quot;Recovered in f&quot;</span>, r)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;()</span><br><span class="line">    fmt.Println(<span class="string">&quot;Calling g.&quot;</span>)</span><br><span class="line">    g(<span class="number">0</span>)</span><br><span class="line">    fmt.Println(<span class="string">&quot;Returned normally from g.&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">g</span><span class="params">(i <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> i &gt; <span class="number">3</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;Panicking!&quot;</span>)</span><br><span class="line">        <span class="built_in">panic</span>(fmt.Sprintf(<span class="string">&quot;%v&quot;</span>, <span class="string">&quot;asdadada&quot;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">defer</span> fmt.Println(<span class="string">&quot;Defer in g&quot;</span>, i)</span><br><span class="line">    fmt.Println(<span class="string">&quot;Printing in g&quot;</span>, i)</span><br><span class="line">    g(i + <span class="number">1</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后的输出</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Calling g.</span><br><span class="line">Printing in g 0</span><br><span class="line">Printing in g 1</span><br><span class="line">Printing in g 2</span><br><span class="line">Printing in g 3</span><br><span class="line">Panicking!</span><br><span class="line">Defer in g 3</span><br><span class="line">Defer in g 2</span><br><span class="line">Defer in g 1</span><br><span class="line">Defer in g 0</span><br><span class="line">Recovered in f asdadada</span><br><span class="line">Returned normally from f.</span><br></pre></td></tr></table></figure>

<p>可以简单的看出</p>
<ol>
<li><code>Panicking</code> 是在所有的 <code>defer</code> 执行之后再进行工作</li>
<li><code>recover</code> 可以简单的理解为在 <code>defer</code> 中处理 <code>panic</code> 函数传过来的值</li>
</ol>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ol>
<li><a target="_blank" rel="noopener" href="https://www.gitbook.com/book/wizardforcel/gopl-zh/details">gopl-zh</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.golang.org/defer-panic-and-recover">defer, panic and recover</a></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/06/07/golang-learning-1/" data-id="ckx7kmlbx000crzc89uyt7gpk" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/golang/" rel="tag">golang</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-golang-at-ubuntu-16.04" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/05/29/golang-at-ubuntu-16.04/" class="article-date">
  <time datetime="2016-05-28T16:00:00.000Z" itemprop="datePublished">2016-05-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/05/29/golang-at-ubuntu-16.04/">Golang 开发配置 @ ubuntu 16.04 LTS</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><p>ubuntu 16.04 的源的 Golang 的版本是 1.6+ 的，不用像 14.04 那样需要自己手动去更新版本。</p>
<p>在 <code>$HOME/.zshrc</code> 上配置该变量</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> GOPATH=/home/lycheng/projects/go</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="string">&quot;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:<span class="variable">$GOPATH</span>/bin&quot;</span></span><br></pre></td></tr></table></figure>

<p>其中 <code>$GOPATH</code> 是一个重要的环境变量，该目录用于存放源代码和可执行文件。大概的结构如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">├── bin # 可执行文件</span><br><span class="line">│   ├── govendor</span><br><span class="line">│   ├── motion</span><br><span class="line">│   └── ...</span><br><span class="line">├── pkg # 外部的包依赖</span><br><span class="line">│   └── linux_amd64</span><br><span class="line">│       ├── 9fans.net</span><br><span class="line">│       ├── github.com</span><br><span class="line">│       └── ...</span><br><span class="line">└── src # 源代码</span><br><span class="line">    ├── 9fans.net</span><br><span class="line">    │   └── go</span><br><span class="line">    ├── github.com</span><br><span class="line">    │   ├── alecthomas</span><br><span class="line">    │   ├── aws</span><br><span class="line">    │   └── ...</span><br><span class="line">    ├── golang.org</span><br><span class="line">    │   └── x</span><br><span class="line">    ├── gopkg.in</span><br><span class="line">    │   └── alecthomas</span><br><span class="line">    └── sourcegraph.com</span><br><span class="line">        └── sqs</span><br></pre></td></tr></table></figure>

<p>基本上开发实在 <code>$GOPATH/src/github.com/&#123;username&#125;/&#123;project&#125;</code> 下进行，同时使用 github 作为版本管理平台，完美。</p>
<h2 id="编辑器-IDE"><a href="#编辑器-IDE" class="headerlink" title="编辑器 / IDE"></a>编辑器 / IDE</h2><p>我的主力开发工具是 vim</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 16.04 里面的没人 vim 不开 python 支持了</span></span><br><span class="line"><span class="comment"># 这是单纯的命令行版本</span></span><br><span class="line">sudo apt-get install vim-nox</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 也可以使用别的项目</span></span><br><span class="line"><span class="comment"># 主要是需要 https://github.com/fatih/vim-go</span></span><br><span class="line">git <span class="built_in">clone</span> git://github.com/lycheng/dot-vimrc.git ~/.vim</span><br><span class="line">ln -s ~/.vim/vimrc ~/.vimrc</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/gmarik/vundle.git ~/.vim/bundle/vundle</span><br></pre></td></tr></table></figure>

<p>在 vim 里面</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">:BundleInstall</span><br><span class="line">:GoInstallBinaries</span><br></pre></td></tr></table></figure>

<p>编译 YCM</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/.vim/bundle/YouCompleteMe</span><br><span class="line">./install.py --clang-completer --gocode-completer</span><br></pre></td></tr></table></figure>

<p>YCM 不是一个必要的条件，可参考文末的 <a target="_blank" rel="noopener" href="http://farazdagi.com/blog/2015/vim-as-golang-ide/">文章</a> 去配置 <code>neocomplete.vim</code> 作为代码提示插件。</p>
<p>idea 和 vscode 都有对 Golang 很好的支持，一般情况下我都是开着 vscode 看代码然后使用 vim 进行开发。</p>
<p>因为众所周知的原因，vim vscode 不少的依赖是需要架梯子去下载的。可设置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> http_proxy=http://127.0.0.1:1080/</span><br><span class="line"><span class="built_in">export</span> https_proxy=<span class="variable">$http_proxy</span></span><br></pre></td></tr></table></figure>

<h2 id="依赖管理"><a href="#依赖管理" class="headerlink" title="依赖管理"></a>依赖管理</h2><p>一般普通的包的安装只要简单的命令即可</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get -u github.com/kardianos/govendor</span><br></pre></td></tr></table></figure>

<p><code>go get</code> 命令包含两层意思</p>
<ol>
<li>下载源码包到 <code>$GOPATH/src/..</code> 中</li>
<li>生成链接对象 （*.a） 到 <code>$GOPATH/pkg/...</code> 中，如有必要也会生成可执行文件到 <code>$GOPATH/bin</code> 中</li>
</ol>
<p>用该命令能很方便的进行 Golang 的第三方包的下载，实际使用的使用也只需要</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;github.com/&#123;username&#125;/&#123;proj&#125;/&#123;package&#125;...&quot;</span></span><br></pre></td></tr></table></figure>

<p>就能正常使用了。但如果需要项目级别的依赖管理，就需要用到 <code>govendor</code></p>
<h3 id="govendor"><a href="#govendor" class="headerlink" title="govendor"></a>govendor</h3><p>使用 govendor 必须是要求 Golang 版本 1.5+。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get -u github.com/kardianos/govendor</span><br></pre></td></tr></table></figure>

<p>基本用法</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Setup your project.</span></span><br><span class="line"><span class="built_in">cd</span> <span class="string">&quot;my project in GOPATH&quot;</span></span><br><span class="line">govendor init</span><br><span class="line"></span><br><span class="line"><span class="comment"># Add existing GOPATH files to vendor.</span></span><br><span class="line">govendor add +external</span><br><span class="line"></span><br><span class="line"><span class="comment"># View your work.</span></span><br><span class="line">govendor list</span><br><span class="line"></span><br><span class="line"><span class="comment"># Look at what is using a package</span></span><br><span class="line">govendor list -v fmt</span><br><span class="line"></span><br><span class="line"><span class="comment"># Specify a specific version or revision to fetch</span></span><br><span class="line">govendor fetch golang.org/x/net/context@a4bbce9fcae005b22ae5443f6af064d80a6f5a55</span><br><span class="line">govendor fetch golang.org/x/net/context@v1   <span class="comment"># Get latest v1.*.* tag or branch.</span></span><br><span class="line">govendor fetch golang.org/x/net/context@=v1  <span class="comment"># Get the tag or branch named &quot;v1&quot;.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Update a package to latest, given any prior version constraint</span></span><br><span class="line">govendor fetch golang.org/x/net/context</span><br></pre></td></tr></table></figure>

<p>初始化之后 govendor 会在项目文件内创建一个 vendor 的文件夹，会将相应的第三方依赖下载到该目录下，目录的组织机构和 <code>$GOPATH</code> 一样。</p>
<p>更多的细节可见 <a target="_blank" rel="noopener" href="https://github.com/kardianos/govendor">这里</a></p>
<h2 id="个人见解"><a href="#个人见解" class="headerlink" title="个人见解"></a>个人见解</h2><p>在用了两年 Python 之后，再来尝试 Golang，其实第一感觉是它的语法挺啰嗦的。然后认认真真写了几天代码之后其实感觉挺好的，啰嗦带来的好处就是有些问题，特别是变量的类型问题在运行前就可以发现了，<code>go fmt</code> 带来的好处是各个人的代码都起码不会太难看。</p>
<p>因为是静态类型，各种工具的支持很棒，例如 <a target="_blank" rel="noopener" href="https://sourcegraph.com/">这个</a> 东西就很棒，在 github 上看代码太舒服了。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ol>
<li><a target="_blank" rel="noopener" href="http://farazdagi.com/blog/2015/vim-as-golang-ide/">配置 VIM 作为 IDE</a></li>
<li><a target="_blank" rel="noopener" href="https://sourcegraph.com/">一个超棒的 chrome 插件 / 网站，用于浏览 github 的源代码，目前只支持 Golang</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/kardianos/govendor">govendor</a></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/05/29/golang-at-ubuntu-16.04/" data-id="ckx7kmlbv0009rzc8c4ux4l3h" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/golang/" rel="tag">golang</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ubuntu/" rel="tag">ubuntu</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-virtualenvwrapper" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/03/12/virtualenvwrapper/" class="article-date">
  <time datetime="2016-03-11T16:00:00.000Z" itemprop="datePublished">2016-03-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/12/virtualenvwrapper/">virtualenvwrapper 使用记录</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a target="_blank" rel="noopener" href="http://virtualenvwrapper.readthedocs.org/en/latest/">virtualenvwrapper</a> 是个方便管理 virtualenv 工具。</p>
<h2 id="初始化环境"><a href="#初始化环境" class="headerlink" title="初始化环境"></a>初始化环境</h2><p>当前使用的是 Arch 所以默认版本为 python3，以下为在该环境下的使用方法</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">sudo pip2 install virtualenvwrapper</span><br><span class="line">...</span><br><span class="line">export WORKON_HOME=~/Envs</span><br><span class="line">mkdir -p $WORKON_HOME</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在使用默认版本 py3 的环境里面，如果需要使用 py2 的话，则需要另外加一行</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 如果只是 py3 的话不需要理会</span></span><br><span class="line">export VIRTUALENVWRAPPER_PYTHON=/usr/local/bin/python2.7</span><br><span class="line"></span><br><span class="line">source /usr/bin/virtualenvwrapper.sh</span><br><span class="line">mkvirtualenv env</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 加载系统现有的包去初始化环境</span></span><br><span class="line">mkvirtualenv env --system-site-packages</span><br></pre></td></tr></table></figure>

<p>在 <code>.zshrc</code> 中加入</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">source /usr/bin/virtualenvwrapper.sh</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 具体的文件位置不一定</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 官方文档的例子是 <span class="built_in">source</span> /usr/<span class="built_in">local</span>/bin/virtualenvwrapper.sh</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 可用 find / -name virtualenvwrapper.sh 去确定.</span></span><br></pre></td></tr></table></figure>

<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># 创建环境</span><br><span class="line">mkvirtualenv env</span><br><span class="line"></span><br><span class="line">pip2 install requests</span><br><span class="line"></span><br><span class="line"># 切换环境</span><br><span class="line">workon env2</span><br><span class="line"></span><br><span class="line"># 离开环境</span><br><span class="line">deactivate</span><br><span class="line"></span><br><span class="line"># 查看当前环境安装的包</span><br><span class="line">lssitepackages</span><br><span class="line"></span><br><span class="line"># 其他操作</span><br><span class="line">lsvirtualenv, rmvirtualenv</span><br></pre></td></tr></table></figure>

<h2 id="项目管理"><a href="#项目管理" class="headerlink" title="项目管理"></a>项目管理</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 在已有的项目使用虚拟环境，然后在下次进入该项目的时候就回自动启用虚拟环境</span><br><span class="line"></span><br><span class="line">setvirtualenvproject [virtualenv_path project_path]</span><br></pre></td></tr></table></figure>

<p>在设置了虚拟环境之后，执行 <code>workon env</code> 就可以自动跳转到项目路径，如果在别的路径下面使用可以不自动跳转 <code>workon env -n</code></p>
<h2 id="其它一些东西"><a href="#其它一些东西" class="headerlink" title="其它一些东西"></a>其它一些东西</h2><p>如果需要在 env 环境下手动安装依赖，需要指定 python，如</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/home/lycheng/Env/tw/bin/python setup.py install</span><br></pre></td></tr></table></figure>

<p>命令行更好的提示</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> <span class="variable">$WORKON_HOME</span>/postactivate</span></span><br><span class="line">PS1=&quot;$_OLD_VIRTUAL_PS1&quot;</span><br><span class="line">_OLD_RPROMPT=&quot;$RPROMPT&quot;</span><br><span class="line">RPROMPT=&quot;%&#123;$&#123;fg_bold[white]&#125;%&#125;(env: %&#123;$&#123;fg[green]&#125;%&#125;`basename \&quot;$VIRTUAL_ENV\&quot;`%&#123;$&#123;fg_bold[white]&#125;%&#125;)%&#123;$&#123;reset_color&#125;%&#125; $RPROMPT&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="variable">$WORKON_HOME</span>/postdeactivate</span></span><br><span class="line">RPROMPT=&quot;$_OLD_RPROMPT&quot;</span><br></pre></td></tr></table></figure>

<h2 id="暂时的问题"><a href="#暂时的问题" class="headerlink" title="暂时的问题"></a>暂时的问题</h2><p>目前还有的问题就是，通过 cd 真的会自动切换虚拟环境，但是在 tmux 中，新建 session，切分窗口也不能自动使用路径对应的虚拟环境。必须手动重新加载一次。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ol>
<li><a target="_blank" rel="noopener" href="http://virtualenvwrapper.readthedocs.org/en/latest/index.html">官方文档</a></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/03/12/virtualenvwrapper/" data-id="ckx7kmlbw000brzc87ov846iy" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/" rel="tag">python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/virtualenv/" rel="tag">virtualenv</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/virtualenvwrapper/" rel="tag">virtualenvwrapper</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-javascript-oo" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/12/20/javascript-oo/" class="article-date">
  <time datetime="2015-12-19T16:00:00.000Z" itemprop="datePublished">2015-12-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/20/javascript-oo/">Javascript 面向对象</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="创建对象"><a href="#创建对象" class="headerlink" title="创建对象"></a>创建对象</h2><p>以下是几种创建对象的方法</p>
<h3 id="工厂模式"><a href="#工厂模式" class="headerlink" title="工厂模式"></a>工厂模式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createPerson</span>(<span class="params">name, age</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> o = <span class="keyword">new</span> <span class="built_in">Object</span>(&#123;&#125;);</span><br><span class="line">  o.name = name;</span><br><span class="line">  o.age = age;</span><br><span class="line">  o.sayName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(o.name);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> o;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>缺点是：无法识别对象</p>
<h3 id="构造函数模式"><a href="#构造函数模式" class="headerlink" title="构造函数模式"></a>构造函数模式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name, age</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.name = name;</span><br><span class="line">  <span class="built_in">this</span>.age = age;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">this</span>.sayName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.name);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> persion1 = <span class="keyword">new</span> Person(<span class="string">&quot;lycheng&quot;</span>, <span class="number">123</span>);</span><br><span class="line"><span class="built_in">console</span>.log(person1.constructor == Person); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(person1 <span class="keyword">instanceof</span> Person); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(person1 <span class="keyword">instanceof</span> <span class="built_in">Object</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p>上述代码中，如果不用 <code>new</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person2 = Person(<span class="string">&quot;person2&quot;</span>, <span class="number">123</span>);</span><br><span class="line"><span class="built_in">console</span>.log(person2); <span class="comment">// undefined</span></span><br><span class="line"><span class="built_in">global</span>.sayName(); <span class="comment">// person2</span></span><br></pre></td></tr></table></figure>

<p>因为当在全局环境中调用函数，<code>this</code> 总是指向 <code>global</code>，所以在使用构造函数的时候必须使用 <code>new</code> 来新建对象。</p>
<p>构造函数模式比起工厂模式更加像面向对象了，但是有个问题就是内部的函数都是每个对象不同的。意味着在新建对象的时候又要重新新建一个方法对象。</p>
<h3 id="原型模式"><a href="#原型模式" class="headerlink" title="原型模式"></a>原型模式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Person.prototype.name = <span class="string">&quot;lycheng&quot;</span>;</span><br><span class="line">Person.prototype.age = <span class="number">25</span>;</span><br><span class="line">Person.prototype.sayName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">this</span>,name);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person1 = <span class="keyword">new</span> Person();</span><br><span class="line"><span class="keyword">var</span> person2 = <span class="keyword">new</span> Person();</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(person1.sayName == person2.sayName); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p>从上面的代码可见，对象 person1 和 person2 的 sayName 函数是同一个了。也可以才用下方的字面值的写法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Person.prototype = &#123;</span><br><span class="line">  <span class="attr">constructor</span>: Person, <span class="comment">// 用于类型判断</span></span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;lycheng&quot;</span>,</span><br><span class="line">  <span class="attr">skills</span>: [<span class="string">&quot;javascript&quot;</span>, <span class="string">&quot;python&quot;</span>],</span><br><span class="line">  <span class="attr">age</span>: <span class="number">25</span>,</span><br><span class="line">  <span class="attr">sayName</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.age);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>简单的原型模式大概如此，这种方法的问题在于，没有构造函数，所有的实例共享所有的变量，如果是引用类型的化，则会出现问题。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person1 = <span class="keyword">new</span> Person();</span><br><span class="line">person1.sayName();</span><br><span class="line">person1.skills.push(<span class="string">&quot;linux&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person2 = <span class="keyword">new</span> Person();</span><br><span class="line"><span class="built_in">console</span>.log(person2.skills);  <span class="comment">// [ &#x27;javascript&#x27;, &#x27;python&#x27;, &#x27;linux&#x27; ]</span></span><br></pre></td></tr></table></figure>

<h3 id="组合使用构造函数和原型"><a href="#组合使用构造函数和原型" class="headerlink" title="组合使用构造函数和原型"></a>组合使用构造函数和原型</h3><p>所以常用的会有混合使用构造函数和原型对象</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name, age</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.name = name;</span><br><span class="line">  <span class="built_in">this</span>.age = age;</span><br><span class="line">  <span class="built_in">this</span>.skills = [];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Person.prototype = &#123;</span><br><span class="line">  <span class="attr">sayName</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.name);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person1 = <span class="keyword">new</span> Person(<span class="string">&quot;lycheng&quot;</span>, <span class="number">25</span>);</span><br><span class="line">person1.skills.push(<span class="string">&quot;linux&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(person1.skills); <span class="comment">// [ &quot;linux&quot; ]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person2 = <span class="keyword">new</span> Person(<span class="string">&quot;lyc&quot;</span>, <span class="number">18</span>);</span><br><span class="line">person2.skills.push(<span class="string">&quot;vim&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(person2.skills); <span class="comment">// [ &quot;vim&quot; ]</span></span><br></pre></td></tr></table></figure>

<p>这种是比较常用的方法，还有更多的动态原型模式，寄生构造函数模式就不一一赘述了。</p>
<h2 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h2><h3 id="原型链"><a href="#原型链" class="headerlink" title="原型链"></a>原型链</h3><p>在之前的文章里也提到过原型，javascript 实现面向对象主要通过原型来实现。通过使用原型，可以实现实例对象共有的方法。这种原型对象的关系称为原型链。</p>
<p>每个对象都有原型，通过指针可以查看原型对象，直到最后为 null。通过这样的方法，如果一个对象的原型指向另一个对象，就可以通过这样的方式实现继承。</p>
<h3 id="继承-1"><a href="#继承-1" class="headerlink" title="继承"></a>继承</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Person.prototype.sayName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">this</span>.name);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Student</span>(<span class="params">name, age</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 继承属性</span></span><br><span class="line">  Person.call(<span class="built_in">this</span>, name, age);</span><br><span class="line">  <span class="built_in">this</span>.age = age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 继承方法</span></span><br><span class="line">Student.prototype = <span class="keyword">new</span> Person();</span><br><span class="line">Student.prototype.constructor = Student;</span><br><span class="line"></span><br><span class="line">Student.prototype.sayAge = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">this</span>.age);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> student = <span class="keyword">new</span> Student(<span class="string">&quot;lycheng&quot;</span>, <span class="number">25</span>);</span><br><span class="line">student.sayName();</span><br><span class="line">student.sayAge();</span><br></pre></td></tr></table></figure>

<p>上述代码中主要通过构造函数来继承实例属性，通过原型链来实现原型方法和属性的继承。</p>
<h3 id="Object-create"><a href="#Object-create" class="headerlink" title="Object.create"></a>Object.create</h3><p>ES5 中可以使用新的方法实现继承，将上述的代码改成如下即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Student.prototype = Object.create(Person.prototype);</span><br></pre></td></tr></table></figure>
<p>简单来讲</p>
<blockquote>
<p>new X is Object.create(X.prototype) with additionally running the constructor function.</p>
</blockquote>
<p><code>Object.create</code> 执行构造函数，但其实我们这里并不需要构造函数，我们仅仅需要的是它的原型部分。但这里两者起到的作用是一样的。</p>
<h2 id="个人想法"><a href="#个人想法" class="headerlink" title="个人想法"></a>个人想法</h2><p>javascript 一些面向对象的实现看起来很诡异，感觉像是硬要为了实现面向对象而将这一套方法论套在基于原型的 javascript 里面。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ol>
<li><a target="_blank" rel="noopener" href="http://www.ituring.com.cn/book/946">Javascript 高级程序设计</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Inheritance_and_the_prototype_chain">继承与原型链</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Introduction_to_Object-Oriented_JavaScript#JavaScript_Review">javascript 面向对象介绍</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/create">create</a></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/12/20/javascript-oo/" data-id="ckx7kmlbu0008rzc89kyegaq7" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-about-react" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/12/06/about-react/" class="article-date">
  <time datetime="2015-12-05T16:00:00.000Z" itemprop="datePublished">2015-12-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/06/about-react/">react 安利文</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a target="_blank" rel="noopener" href="https://facebook.github.io/react/">React</a> 是 Facebook 开源的一款 <em>仅仅</em> 是 javascript 库。当然，现在已经是讲类似的理念推广到了 React Native 去，用于开发 Android 和 iOS 的程序。</p>
<p>这篇文章是一篇 <em>安利</em> 文，没有涉及到更多的高深的东西，老手请右上角。</p>
<h2 id="基本的东西"><a href="#基本的东西" class="headerlink" title="基本的东西"></a>基本的东西</h2><h3 id="简单例子"><a href="#简单例子" class="headerlink" title="简单例子"></a>简单例子</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> TodoList = React.createClass(&#123;</span><br><span class="line">  <span class="attr">render</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> createItem = <span class="function"><span class="keyword">function</span>(<span class="params">item</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span>&gt;</span>&#123;item.text&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">ul</span>&gt;</span>&#123;this.props.items.map(createItem)&#125;<span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">var</span> TodoApp = React.createClass(&#123;</span><br><span class="line">  <span class="attr">getInitialState</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="attr">items</span>: [], <span class="attr">text</span>: <span class="string">&#x27;&#x27;</span>&#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">onChange</span>: <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.setState(&#123;<span class="attr">text</span>: e.target.value&#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">handleSubmit</span>: <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    e.preventDefault();</span><br><span class="line">    <span class="keyword">var</span> nextItems = <span class="built_in">this</span>.state.items.concat([&#123;<span class="attr">text</span>: <span class="built_in">this</span>.state.text, <span class="attr">id</span>: <span class="built_in">Date</span>.now()&#125;]);</span><br><span class="line">    <span class="keyword">var</span> nextText = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="built_in">this</span>.setState(&#123;<span class="attr">items</span>: nextItems, <span class="attr">text</span>: nextText&#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">render</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>TODO<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">TodoList</span> <span class="attr">items</span>=<span class="string">&#123;this.state.items&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">onSubmit</span>=<span class="string">&#123;this.handleSubmit&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">input</span> <span class="attr">onChange</span>=<span class="string">&#123;this.onChange&#125;</span> <span class="attr">value</span>=<span class="string">&#123;this.state.text&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">button</span>&gt;</span>&#123;&#x27;Add #&#x27; + (this.state.items.length + 1)&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">TodoApp</span> /&gt;</span></span>, mountNode);</span><br></pre></td></tr></table></figure>

<p>这是个官网偷回来的例子，简单来说就是一个输入，enter 之后添加一个 ToDoList 的条目。基本结构再 ToDoApp 的 render 函数里面可以看到。</p>
<p>在 render 里面也可以看到通过参数调用 ToDoList 去渲染已经添加的 ToDo 条目。</p>
<h3 id="JSX"><a href="#JSX" class="headerlink" title="JSX"></a>JSX</h3><p>上述的不像 javascript 的代码是 jsx，最后真正使用的时候需要编译成 javascript 来写，当然也可以用 react 手写 javascript，那会麻烦很多。</p>
<p>值得一提的是，我刚开始用的时候，编译需要用到 <code>JSXTransformer.js</code> 这个东西，在官网新版已经不见了。新版使用的是 <a target="_blank" rel="noopener" href="https://babeljs.io/">babel</a> 进行编译。Google 搜出来第一个中文的关于 React 的网站就是使用的旧版，除了编译以外，一些调用方法也发生了改变。</p>
<h3 id="state"><a href="#state" class="headerlink" title="state"></a>state</h3><p>这个是核心的东西，上述代码中</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.setState(&#123;<span class="attr">items</span>: nextItems, <span class="attr">text</span>: nextText&#125;);</span><br></pre></td></tr></table></figure>

<p>调用该函数之后，React 会重新渲染，重新执行 render 函数去生成新的页面。每次重新生成的时候，会通过 diff 去判断哪些元素需要更新，而不是全部是重新刷新。</p>
<p>但不是所有的变量都需要 state，大部分的变量只需要 props 就好了。</p>
<h2 id="组件化"><a href="#组件化" class="headerlink" title="组件化"></a>组件化</h2><p>在上面的例子我们看到，我们定义了两个类 TodoApp 和 TodoList。两者是一个从属关系，当页面逻辑比较丰富的时候，可以抽出更多的类，一些也可以复用。关系如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">TodoApp</span><br><span class="line">- ToDoList</span><br></pre></td></tr></table></figure>

<p>如果需要更复杂的关系，可以新增一个 ToDoItem</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ToDoApp</span><br><span class="line">- ToDoList</span><br><span class="line"> - ToDoItem</span><br></pre></td></tr></table></figure>

<p>没有用过除了 jQuery 的前端库，第一次用下来的感觉是非常流畅，没有之前用 jQuery 时候的割裂感。这个感觉是之前感觉是数据和展现是脱节的，需要手动去处理很多数据变更之后的东西，清理现场等等。</p>
<p>这篇 <a target="_blank" rel="noopener" href="https://facebook.github.io/react/docs/reconciliation.html">文章</a> 聊了下 react 组件化的东西，强烈推荐。</p>
<h2 id="总结下"><a href="#总结下" class="headerlink" title="总结下"></a>总结下</h2><p>在公司项目中一次开发中，因为前一晚刚好看了下 react 的东西，于是觉得合适就开始用起来了，基本没有门槛，分类分层次组件的东西写起来感觉很清爽，很多时候只需要注意维护 state 就好了。</p>
<p>感觉是前端这块工具发展得很快，多尝试下各种新的东西对自己一些思维上的帮助是很大的。react 这种组件的方式对于我这种一直用着 jQuery 那种库来写前端的人来说简直就是一次思维方式的洗礼。</p>
<h2 id="更多好玩的东西"><a href="#更多好玩的东西" class="headerlink" title="更多好玩的东西"></a>更多好玩的东西</h2><ol>
<li><a target="_blank" rel="noopener" href="https://blog.coding.net/blog/React-server-rendering">React 服务器渲染</a></li>
<li><a target="_blank" rel="noopener" href="https://facebook.github.io/react/docs/reconciliation.html">React Diff</a></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/12/06/about-react/" data-id="ckx7kmlbs0005rzc89hq63dll" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/react/" rel="tag">react</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-about-python-reading-notes" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/12/03/about-python-reading-notes/" class="article-date">
  <time datetime="2015-12-02T16:00:00.000Z" itemprop="datePublished">2015-12-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/03/about-python-reading-notes/">关于 《Python 学习笔记》</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>最近看 <a target="_blank" rel="noopener" href="https://github.com/qyuhen/book">Python 学习笔记</a> 记录下一些之前没注意的东西。</p>
<h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><h3 id="虚拟机初始化顺序"><a href="#虚拟机初始化顺序" class="headerlink" title="虚拟机初始化顺序"></a>虚拟机初始化顺序</h3><ol>
<li>创建解释器和主线程状态对象,这是整个进程的根对象。</li>
<li>初始化内置类型。数字、列表等类型都有专门的缓存策略需要处理。</li>
<li>创建 <code>__builtin__</code> 模块,该模块持有所有内置类型和函数。</li>
<li>创建 sys 模块,其中包含了 sys.path、modules 等重要的运行行期信息。</li>
<li>初始化 import 机制。</li>
<li>初始化内置 Exception。</li>
<li>创建 <code>__main__</code> 模块,准备运行行所需的名字空间。</li>
<li>通过 site.py 将 site-packages 中的第三方方扩展库添加到搜索路径列表。</li>
<li>执行行入入口口 py 文文件。执行行前会将 <code>__main__.__dict__</code> 作为名字空间传递进去。</li>
<li>程序执行行结束。</li>
<li>执行行清理操作,包括调用用退出函数,GC 清理现场,释放所有模块等。</li>
<li>终止止进程。</li>
</ol>
<h3 id="对象"><a href="#对象" class="headerlink" title="对象"></a>对象</h3><p>一切皆对象，引用计数来进行拉圾回收机制。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">a = <span class="number">456</span></span><br><span class="line">sys.getrefcount(a)  <span class="comment"># 2</span></span><br><span class="line">b = a</span><br><span class="line">sys.getrefcount(a)  <span class="comment"># 3</span></span><br><span class="line"><span class="keyword">del</span> b</span><br><span class="line">sys.getrefcount(a)  <span class="comment"># 2</span></span><br></pre></td></tr></table></figure>
<p>初始化之后计数是 2 的原因是，当你调用 <code>sys.getrefcount</code> 的时候，<code>a</code> 复制了一遍，所以就是 2 了。</p>
<h3 id="名字空间"><a href="#名字空间" class="headerlink" title="名字空间"></a>名字空间</h3><p>python 中的变量，更多的时候用名字来表示会更好理解，在 Py 里面，变量仅仅用来指向内存中的某一个实际的对象 <code>name-&gt;object</code>，所以在函数传值也仅仅是告诉函数需要用到的参数是哪个，如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">alter</span>(<span class="params">bar</span>):</span></span><br><span class="line">    bar.append(<span class="number">4</span>)</span><br><span class="line">    bar = [<span class="number">0</span>,<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">foo = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line"><span class="built_in">print</span> <span class="string">&#x27;foo&#x27;</span>, foo <span class="comment"># [1, 2, 3]</span></span><br><span class="line">alter(foo)</span><br><span class="line"><span class="built_in">print</span> <span class="string">&#x27;foo&#x27;</span>, foo <span class="comment"># [1, 2, 3, 4]</span></span><br></pre></td></tr></table></figure>

<p>上述的代码中，<code>bar = [0, 1]</code> 实际上是改变了函数名字空间内的 <code>bar</code> 的指向而已，不对函数外的 <code>foo</code> 有任何影响。</p>
<p>在 Py 中，可以通过函数 <code>globals</code> 和 <code>locals</code> 查看模块的名字空间，以及函数内的名字空间，在函数外部调用的时候，两者相同。</p>
<p>也可以通过 <code>&lt;module&gt;.__dict__</code> 查看其它模块的名字空间。</p>
<h3 id="内存管理"><a href="#内存管理" class="headerlink" title="内存管理"></a>内存管理</h3><p>总是引用传递。</p>
<p>避免循环引用。</p>
<h2 id="内置类型"><a href="#内置类型" class="headerlink" title="内置类型"></a>内置类型</h2><h3 id="int"><a href="#int" class="headerlink" title="int"></a>int</h3><p><code>int</code> 类型是特殊处理的，[-5, 257) 之前的小数字通过固定数组来存储，通过下标来获得指针。其它情况通过 <code>PyIntBlock</code> 缓存区存储整数类型，直到进程结束，这部分内存才还给操作系统。</p>
<p>所以对大整数一类的操作需要谨慎，多使用 <code>xrange</code> 去替代 <code>range</code>，这样一些内存就能省下来。</p>
<h3 id="float"><a href="#float" class="headerlink" title="float"></a>float</h3><p>精度不足，一些小数的操作需要谨慎</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">3</span> * <span class="number">0.1</span> == <span class="number">0.3</span> <span class="comment"># False</span></span><br></pre></td></tr></table></figure>

<p>使用 <code>Decimal</code> 去替代 <code>float</code> 就能解决问题。内存方面也采取和 <code>int</code> 的策略，但没有针对小的浮点数去处理。</p>
<h3 id="string"><a href="#string" class="headerlink" title="string"></a>string</h3><p>动态生成的字符串可用 <code>intern</code> 进行池化，简单来说，就是让这个字符串变成一个引用，而不是一个每次都重新生成的字符串，用于节省内存。</p>
<h3 id="list"><a href="#list" class="headerlink" title="list"></a>list</h3><p>列表对象和存储元素指针的数组是分开的两块内存，后者在堆上分配。</p>
<p>如果需要频繁进行元素的增删，可用数组 <code>array</code> 代替，这个直接内存数据，省了创建对象的开销。</p>
<h3 id="dict"><a href="#dict" class="headerlink" title="dict"></a>dict</h3><p>要去判断两个字典间的差异，可以使用视图。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">d1 = <span class="built_in">dict</span>(a = <span class="number">1</span>, b = <span class="number">2</span>)</span><br><span class="line">d2 = <span class="built_in">dict</span>(b = <span class="number">2</span>, c = <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">v1 = d1.viewitems()</span><br><span class="line">v2 = d2.viewitems()</span><br><span class="line"></span><br><span class="line">v1 &amp; v2 <span class="comment"># &#123;(&#x27;b&#x27;, 2)&#125;</span></span><br><span class="line">v1 | v2 <span class="comment"># &#123;(&#x27;a&#x27;, 1), (&#x27;b&#x27;, 2), (&#x27;c&#x27;, 3)&#125;</span></span><br><span class="line">v1 - v2 <span class="comment"># &#123;(&#x27;a&#x27;, 1)&#125;</span></span><br></pre></td></tr></table></figure>
<p>视图还有一个很实用的地方就是，当你更新了原来的 <code>dict</code> 之后，视图也会同时更新。</p>
<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><h3 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h3><p>默认参数使用可变类型时需要注意，它的值在函数创建的时候就存在了，这个很容易出错</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fun</span>(<span class="params">a, b=[]</span>):</span></span><br><span class="line">    b.append(a)</span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line"></span><br><span class="line">test(<span class="number">1</span>) <span class="comment"># b = [1]</span></span><br><span class="line">test(<span class="number">2</span>) <span class="comment"># b = [1, 2]</span></span><br><span class="line">test(<span class="number">1</span>, []) <span class="comment"># return [1] b = [1, 2]</span></span><br><span class="line">test(<span class="number">3</span>) <span class="comment"># b = [1, 2, 3]</span></span><br></pre></td></tr></table></figure>
<p>需要用这类可变类型的参数时，可以 <code>b=None</code> 再在函数内进行判断。</p>
<h3 id="作用域"><a href="#作用域" class="headerlink" title="作用域"></a>作用域</h3><p>函数参数和内部变量都存在 <code>locals</code> 的名字空间中。</p>
<p>名字的查找顺序为 <code>locals -&gt; enclosing function -&gt; globals -&gt; __builtins__</code></p>
<h3 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h3><p>当函数离开创建环境时，依然保留其上下文状态。下例，是因为 x 的添加到 <code>func_closure</code> 列表中，引用计数增加了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span>():</span></span><br><span class="line">    x = [<span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line">    <span class="built_in">print</span> <span class="built_in">hex</span>(<span class="built_in">id</span>(x)) <span class="comment"># same</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">a</span>():</span></span><br><span class="line">        x.append(<span class="number">3</span>)</span><br><span class="line">        <span class="built_in">print</span> <span class="built_in">hex</span>(<span class="built_in">id</span>(x))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">b</span>():</span></span><br><span class="line">        <span class="built_in">print</span> <span class="built_in">hex</span>(<span class="built_in">id</span>(x))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> a, b</span><br><span class="line">a, b = test()</span><br><span class="line">a() <span class="comment"># same</span></span><br><span class="line">b() <span class="comment"># same</span></span><br></pre></td></tr></table></figure>

<h3 id="协程"><a href="#协程" class="headerlink" title="协程"></a>协程</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">coroutine</span>():</span></span><br><span class="line">    <span class="built_in">print</span> <span class="string">&#x27;start&#x27;</span></span><br><span class="line">    result = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        s = <span class="keyword">yield</span> result</span><br><span class="line">        result = s.split(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line"></span><br><span class="line">c = coroutine()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动协程</span></span><br><span class="line">c.send(<span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 向协程发送消息</span></span><br><span class="line"><span class="built_in">print</span> c.send(<span class="string">&#x27;a,b&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span> c.send(<span class="string">&#x27;c,d&#x27;</span>)</span><br><span class="line"></span><br><span class="line">c.close()</span><br></pre></td></tr></table></figure>
<p>上面的代码的流程如下：</p>
<ol>
<li>创建协程后对象,必须使用用 send(None) 或 next() 启动。</li>
<li>协程在执行行 yield result 后让出执行行绪,等待消息。</li>
<li>调用用方方发送 send(“a,b”) 消息,协程恢复执行行,将接收到的数据保存到 s,执行行后续流程。</li>
<li>再次循环到 yeild,协程返回</li>
<li>直到关闭或被引发异常</li>
</ol>
<h2 id="模块"><a href="#模块" class="headerlink" title="模块"></a>模块</h2><h3 id="搜索路径"><a href="#搜索路径" class="headerlink" title="搜索路径"></a>搜索路径</h3><ol>
<li>当前的进程根目录</li>
<li>PYTHONPATH 环境变量指定的路径列表</li>
<li>Python 标准库的目录列表</li>
<li>路径文件保存的目录</li>
</ol>
<p>当进程启动之后，所有的这些路径都被组织到 <code>sys.path</code> 列表中，任何 <code>import</code> 操作都会按照 <code>sys.path</code> 来查找模块。</p>
<p>进程中的模块对象都是唯一的。在首次成功导入之后，模块对象被添加到 <code>sys.modules</code> ，以后的操作都总是先检查模块对象是否已经存在。</p>
<h2 id="类"><a href="#类" class="headerlink" title="类"></a>类</h2><h3 id="字段和属性"><a href="#字段和属性" class="headerlink" title="字段和属性"></a>字段和属性</h3><p>字段（field）和属性（property）是不同的，</p>
<ol>
<li>实例字段存储在 <code>instance.__dict__</code>, 代表单个对象实体的状态。</li>
<li>静态字段存储在 <code>class.__dict__</code>, 为所有同类型实例共享。</li>
<li>必须通过类型和实例对象才能访问字段。</li>
<li>以双下划线开头的 <code>class</code> 和 <code>instance</code> 成员视为私有，会被重命名。(module 成员不变)</li>
</ol>
<p>属性 (Property) 是由 getter、setter、deleter 几个方方法构成的逻辑，在查找中，属性优先于实例字段。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">name</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.__name</span><br><span class="line"></span><br><span class="line"><span class="meta">    @name.setter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">name</span>(<span class="params">self, value</span>):</span></span><br><span class="line">        self.__name = value</span><br><span class="line"></span><br><span class="line">u = User()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> u.__dict__ <span class="comment"># &#123;&#125;</span></span><br><span class="line">u.name = <span class="string">&quot;lycheng&quot;</span></span><br><span class="line"><span class="built_in">print</span> u.__dict__ <span class="comment"># &#123;&#x27;_User__name&#x27;: &#x27;lycheng&#x27;&#125;</span></span><br><span class="line"><span class="built_in">print</span> u.name</span><br></pre></td></tr></table></figure>

<h3 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h3><p>特殊方法</p>
<ol>
<li><code>__new__</code>: 创建对象实例。</li>
<li><code>__init__</code>: 初始化对象状态。</li>
<li><code>__del__</code>: 对象回收前被调用用。</li>
</ol>
<h3 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h3><p>多重继承成员搜索顺序,也就是 mro (method resolution order) 要稍微复杂一一点。归纳一一下就<br>是:从下到上 (深度优先,从派生生类到基类),从左到右 (基类声明顺序)。mro 和我们前面面提及的成<br>员查找规则是有区别的，<code>__mro__</code> 列表中并没有 instance。所以在表述时,需要注意区别。</p>
<p>super 依照 mro 搜索顺序搜索基类成员</p>
<h2 id="装饰器"><a href="#装饰器" class="headerlink" title="装饰器"></a>装饰器</h2><h3 id="类装饰器"><a href="#类装饰器" class="headerlink" title="类装饰器"></a>类装饰器</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">singleton</span>(<span class="params">cls</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrap</span>(<span class="params">*args, **kwargs</span>):</span></span><br><span class="line">        o = <span class="built_in">getattr</span>(cls, <span class="string">&quot;__instance__&quot;</span>, <span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> o:</span><br><span class="line">            o = cls(*args, **kwargs)</span><br><span class="line">            cls.__instance__ = o</span><br><span class="line">        <span class="keyword">return</span> o</span><br><span class="line">    <span class="keyword">return</span> wrap</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@singleton</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        self.x = x</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> A</span><br><span class="line"></span><br><span class="line">a, b = A(<span class="number">1</span>), A(<span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span> a <span class="keyword">is</span> b <span class="comment"># True</span></span><br></pre></td></tr></table></figure>

<p>将 func wrap 换成 class wrap</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">singleton</span>(<span class="params">cls</span>):</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">wrap</span>(<span class="params">cls</span>):</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__new__</span>(<span class="params">cls, *args, **kwargs</span>):</span></span><br><span class="line">            o = <span class="built_in">getattr</span>(cls, <span class="string">&quot;__instance__&quot;</span>, <span class="literal">None</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> o:</span><br><span class="line">                o = <span class="built_in">object</span>.__new__(cls)</span><br><span class="line">                cls.__instance__ = o</span><br><span class="line">            <span class="keyword">return</span> o</span><br><span class="line">    <span class="keyword">return</span> wrap</span><br><span class="line"></span><br><span class="line"><span class="meta">@singleton</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">self</span>):</span> <span class="built_in">print</span> <span class="built_in">hex</span>(<span class="built_in">id</span>(self))</span><br><span class="line"></span><br><span class="line">a, b = A(), A()</span><br><span class="line"><span class="built_in">print</span> a <span class="keyword">is</span> b</span><br></pre></td></tr></table></figure>

<p>创建继承自自原类型的 class wrap,然后在 <code>__new__</code> 里里面面做手手脚就行行了。上述这个代码可以通过装饰器去修改类型的一些函数，也可以用以下的代码去增加额外的成员。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">action</span>(<span class="params">cls</span>):</span></span><br><span class="line">    cls.func = <span class="built_in">staticmethod</span>(<span class="keyword">lambda</span>: <span class="string">&#x27;hello world&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> cls</span><br><span class="line"></span><br><span class="line"><span class="meta">@action</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Func</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> Func.func()</span><br></pre></td></tr></table></figure>

<h2 id="元类"><a href="#元类" class="headerlink" title="元类"></a>元类</h2><p>元类的关系</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Data = <span class="built_in">type</span>(<span class="string">&quot;Data&quot;</span>, (<span class="built_in">object</span>,), &#123;<span class="string">&quot;x&quot;</span>: <span class="number">1</span>&#125;) <span class="comment"># 实际创建类型的指令</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> = <span class="title">metaclass</span>(<span class="params">...</span>)       # 元类创建类型</span></span><br><span class="line"><span class="class"><span class="title">instance</span> = <span class="title">class</span>(<span class="params">...</span>)        # 类型创建实例</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">instance</span>.<span class="title">__class__</span> <span class="title">is</span> <span class="title">class</span>  # 实例的类型</span></span><br><span class="line"><span class="class"><span class="title">class</span>.<span class="title">__class__</span> <span class="title">is</span> <span class="title">metaclass</span> # 类型的类型</span></span><br></pre></td></tr></table></figure>

<p>自定义元类，需要注意的是，自定义元类都是从 <code>type</code> 继承而来，并且是重写 <code>__new__</code> 方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">InjectMeta</span>(<span class="params"><span class="built_in">type</span></span>):</span> <span class="comment"># 从 type 继承</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span>(<span class="params">cls, name, bases, attrs</span>):</span></span><br><span class="line">        t = <span class="built_in">type</span>.__new__(cls, name, bases, attrs)</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">print_id</span>(<span class="params">self</span>):</span></span><br><span class="line">            <span class="built_in">print</span> <span class="built_in">hex</span>(<span class="built_in">id</span>(self))</span><br><span class="line"></span><br><span class="line">        t.print_id = print_id  <span class="comment"># 为类型对象添加实例方方法。</span></span><br><span class="line">        t.s = <span class="string">&quot;Hello, World!&quot;</span>  <span class="comment"># 添加静态字段。</span></span><br><span class="line">        <span class="keyword">return</span> t</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">cls, name, bases, attrs</span>):</span></span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;class&#x27;</span>, cls</span><br><span class="line">        <span class="built_in">type</span>.__init__(cls, name, bases, attrs)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Data</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    __metaclass__ = InjectMeta</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> Data.s</span><br><span class="line">Data().print_id()</span><br></pre></td></tr></table></figure>

<p>以下是使用元类实现的静态类和密封类（禁止继承）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StaticClassMeta</span>(<span class="params"><span class="built_in">type</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span>(<span class="params">cls, name, bases, attr</span>):</span></span><br><span class="line">        t = <span class="built_in">type</span>.__new__(cls, name, bases, attr)</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">ctor</span>(<span class="params">cls, *args, **kwargs</span>):</span></span><br><span class="line">            <span class="keyword">raise</span> RuntimeError(<span class="string">&quot;Cannot create a instance of the static class!&quot;</span>)</span><br><span class="line">        t.__new__ = <span class="built_in">staticmethod</span>(ctor)</span><br><span class="line">        <span class="keyword">return</span> t</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Data</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    __metaclass__ = StaticClassMeta</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SealedClassMeta</span>(<span class="params"><span class="built_in">type</span></span>):</span></span><br><span class="line">    _types = <span class="built_in">set</span>()</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">cls, name, bases, attrs</span>):</span></span><br><span class="line">        <span class="keyword">if</span> cls._types <span class="keyword">and</span> <span class="built_in">set</span>(bases):</span><br><span class="line">            <span class="keyword">raise</span> SyntaxError(<span class="string">&quot;Cannot inherit from a sealed class!&quot;</span>)</span><br><span class="line">        cls._types.add(cls)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Data</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    __metaclass__ = SealedClassMeta</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>(<span class="params">Data</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<h2 id="标准库"><a href="#标准库" class="headerlink" title="标准库"></a>标准库</h2><h3 id="heapq"><a href="#heapq" class="headerlink" title="heapq"></a>heapq</h3><p>最小堆，完全平衡二叉树，所有节点都小于其子节点</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> heapq <span class="keyword">import</span> heappush, heappop</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> sample</span><br><span class="line"></span><br><span class="line">src = sample(xrange(<span class="number">100</span>), <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">heap = []</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> src:</span><br><span class="line">    heappush(heap, x) <span class="comment"># type(heap) == &#x27;list&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> heap:</span><br><span class="line">    <span class="built_in">print</span> heappop(heap)</span><br></pre></td></tr></table></figure>

<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ol>
<li><a target="_blank" rel="noopener" href="https://github.com/qyuhen/book">https://github.com/qyuhen/book</a></li>
<li><a target="_blank" rel="noopener" href="https://www.python.org/dev/peps/pep-3129/">https://www.python.org/dev/peps/pep-3129/</a></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/12/03/about-python-reading-notes/" data-id="ckx7kmlbs0004rzc86ndscim4" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/" rel="tag">python</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/3/">&amp;laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/5/">Next &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/annotation/" rel="tag">annotation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/architecture/" rel="tag">architecture</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/blog/" rel="tag">blog</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ci/" rel="tag">ci</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/concurrency/" rel="tag">concurrency</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/container/" rel="tag">container</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/context/" rel="tag">context</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/database/" rel="tag">database</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/debug/" rel="tag">debug</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/encoding/" rel="tag">encoding</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/engineering/" rel="tag">engineering</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/error/" rel="tag">error</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/eval/" rel="tag">eval</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/generic/" rel="tag">generic</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/" rel="tag">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/golang/" rel="tag">golang</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http/" rel="tag">http</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/https/" rel="tag">https</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/influxdb/" rel="tag">influxdb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/innodb/" rel="tag">innodb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/" rel="tag">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jenkins/" rel="tag">jenkins</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/k8s/" rel="tag">k8s</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lambda/" rel="tag">lambda</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/memory-leak/" rel="tag">memory-leak</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/metaclass/" rel="tag">metaclass</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/metrics/" rel="tag">metrics</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/microservice/" rel="tag">microservice</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mock/" rel="tag">mock</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/" rel="tag">mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/network/" rel="tag">network</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/" rel="tag">nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/partitions/" rel="tag">partitions</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/patch/" rel="tag">patch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pipeline/" rel="tag">pipeline</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/protocol/" rel="tag">protocol</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/proxy/" rel="tag">proxy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/" rel="tag">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/react/" rel="tag">react</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/reflect/" rel="tag">reflect</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/security/" rel="tag">security</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ssl/" rel="tag">ssl</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sync/" rel="tag">sync</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tcp/" rel="tag">tcp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/thread/" rel="tag">thread</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/timezone/" rel="tag">timezone</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tls/" rel="tag">tls</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/traefik/" rel="tag">traefik</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ubuntu/" rel="tag">ubuntu</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/unittest/" rel="tag">unittest</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/virtualenv/" rel="tag">virtualenv</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/virtualenvwrapper/" rel="tag">virtualenvwrapper</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/annotation/" style="font-size: 10px;">annotation</a> <a href="/tags/architecture/" style="font-size: 10px;">architecture</a> <a href="/tags/blog/" style="font-size: 10px;">blog</a> <a href="/tags/ci/" style="font-size: 10px;">ci</a> <a href="/tags/concurrency/" style="font-size: 10px;">concurrency</a> <a href="/tags/container/" style="font-size: 10px;">container</a> <a href="/tags/context/" style="font-size: 10px;">context</a> <a href="/tags/database/" style="font-size: 10px;">database</a> <a href="/tags/debug/" style="font-size: 10px;">debug</a> <a href="/tags/docker/" style="font-size: 17.5px;">docker</a> <a href="/tags/encoding/" style="font-size: 12.5px;">encoding</a> <a href="/tags/engineering/" style="font-size: 10px;">engineering</a> <a href="/tags/error/" style="font-size: 10px;">error</a> <a href="/tags/eval/" style="font-size: 10px;">eval</a> <a href="/tags/generic/" style="font-size: 10px;">generic</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/golang/" style="font-size: 20px;">golang</a> <a href="/tags/http/" style="font-size: 10px;">http</a> <a href="/tags/https/" style="font-size: 10px;">https</a> <a href="/tags/influxdb/" style="font-size: 10px;">influxdb</a> <a href="/tags/innodb/" style="font-size: 10px;">innodb</a> <a href="/tags/java/" style="font-size: 17.5px;">java</a> <a href="/tags/javascript/" style="font-size: 10px;">javascript</a> <a href="/tags/jenkins/" style="font-size: 10px;">jenkins</a> <a href="/tags/k8s/" style="font-size: 12.5px;">k8s</a> <a href="/tags/lambda/" style="font-size: 10px;">lambda</a> <a href="/tags/memory-leak/" style="font-size: 10px;">memory-leak</a> <a href="/tags/metaclass/" style="font-size: 10px;">metaclass</a> <a href="/tags/metrics/" style="font-size: 10px;">metrics</a> <a href="/tags/microservice/" style="font-size: 10px;">microservice</a> <a href="/tags/mock/" style="font-size: 10px;">mock</a> <a href="/tags/mysql/" style="font-size: 12.5px;">mysql</a> <a href="/tags/network/" style="font-size: 12.5px;">network</a> <a href="/tags/nginx/" style="font-size: 15px;">nginx</a> <a href="/tags/partitions/" style="font-size: 10px;">partitions</a> <a href="/tags/patch/" style="font-size: 10px;">patch</a> <a href="/tags/pipeline/" style="font-size: 10px;">pipeline</a> <a href="/tags/protocol/" style="font-size: 12.5px;">protocol</a> <a href="/tags/proxy/" style="font-size: 10px;">proxy</a> <a href="/tags/python/" style="font-size: 20px;">python</a> <a href="/tags/react/" style="font-size: 10px;">react</a> <a href="/tags/reflect/" style="font-size: 10px;">reflect</a> <a href="/tags/security/" style="font-size: 15px;">security</a> <a href="/tags/ssl/" style="font-size: 10px;">ssl</a> <a href="/tags/sync/" style="font-size: 10px;">sync</a> <a href="/tags/tcp/" style="font-size: 10px;">tcp</a> <a href="/tags/thread/" style="font-size: 10px;">thread</a> <a href="/tags/timezone/" style="font-size: 10px;">timezone</a> <a href="/tags/tls/" style="font-size: 10px;">tls</a> <a href="/tags/traefik/" style="font-size: 10px;">traefik</a> <a href="/tags/ubuntu/" style="font-size: 10px;">ubuntu</a> <a href="/tags/unittest/" style="font-size: 10px;">unittest</a> <a href="/tags/virtualenv/" style="font-size: 10px;">virtualenv</a> <a href="/tags/virtualenvwrapper/" style="font-size: 10px;">virtualenvwrapper</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">十二月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">十月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">十一月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">九月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">八月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">六月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">十月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">十二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">十月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">九月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">八月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">七月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">十月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">六月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">十二月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">十月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">八月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">七月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">六月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">五月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">三月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">十二月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">十月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">八月 2015</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/12/15/designing-data-intensive-applications-note/">Designing Data-Intensive Applications Notes</a>
          </li>
        
          <li>
            <a href="/2021/10/23/oauth-introduction/">OAuth Introduction</a>
          </li>
        
          <li>
            <a href="/2020/11/13/mysql-innodb/">MySQL InnoDB Introduction</a>
          </li>
        
          <li>
            <a href="/2020/09/14/cloud-design-patterns/">Cloud Design Patterns</a>
          </li>
        
          <li>
            <a href="/2020/08/21/about-ssl-tls/">About SSL And TLS</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 Shing<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>